<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cake Card Builder</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body{font-family:'DM Sans',sans-serif;background:#fff7ec;color:#403d58;padding:2rem;}
    h1{text-align:center;}
    .builder{max-width:500px;margin:auto;background:#fff;padding:2rem;border-radius:18px;box-shadow:0 4px 12px rgba(0,0,0,.1);}
    label{font-weight:600;display:block;margin:1rem 0 .3rem;}
    input,textarea{width:100%;padding:.7rem;border:2px solid #ff8ba7;border-radius:12px;font-size:1rem;}
    button{background:#ff8ba7;color:#fff;border:none;padding:.8rem 1.4rem;border-radius:9999px;margin-top:1.5rem;font-size:1rem;cursor:pointer;}
    .preview{margin-top:2rem;text-align:center;}
    .preview-card{background:#fafafa;padding:1rem;border-radius:12px;margin-top:1rem;}
    .link-box{word-break:break-all;background:#fff0f5;padding:.8rem;border-radius:8px;margin-top:1rem;}
  </style>
</head>
<body>
  <h1>ðŸŽ‚ Build Your Cake Card</h1>
  <div class="builder">
    <label for="recipient">Recipient Name</label>
    <input id="recipient" type="text" placeholder="e.g. Max" />

    <label for="message">Custom Message (shown after second blow)</label>
    <textarea id="message" rows="4" placeholder="You're the absolute best little brother ever. Happy birthday!"></textarea>

    <button onclick="generateLink()">Generate Link</button>

    <div class="preview" id="preview" style="display:none;">
      <div class="preview-card">
        <strong>To:</strong> <span id="previewName"></span><br />
        <strong>Encrypted Message:</strong>
        <div id="previewMsg" style="margin-top:0.5rem;font-family:monospace;"></div>
        <div style="margin-top:.5rem;font-size:.9rem;opacity:.7;">(Shift key <span id="previewKey"></span>)</div>
      </div>
      <div class="link-box" id="previewLink"></div>
    </div>
  </div>

<script>
// Caesar cipher helpers
function caesarEncrypt(str,shift){
  return str.split('').map(ch=>{
    const c=ch.charCodeAt(0);
    if(c>=65&&c<=90){return String.fromCharCode(((c-65+shift)%26)+65);} // A-Z
    if(c>=97&&c<=122){return String.fromCharCode(((c-97+shift)%26)+97);} // a-z
    return ch; // punctuation
  }).join('');
}
function randomShift(){return Math.floor(Math.random()*25)+1;} // 1-25

function generateLink(){
  const nameRaw=document.getElementById('recipient').value.trim();
  const msgRaw=document.getElementById('message').value.trim();
  if(!nameRaw||!msgRaw){alert('Please enter both a name and message.');return;}
  const key=randomShift();
  const encrypted=caesarEncrypt(msgRaw,key);
  const link=`index.html?name=${encodeURIComponent(nameRaw)}&msg=${encodeURIComponent(encrypted)}&key=${key}`;

  // preview
  document.getElementById('previewName').textContent=nameRaw;
  document.getElementById('previewMsg').textContent=encrypted;
  document.getElementById('previewKey').textContent=key;
  document.getElementById('previewLink').textContent=(location.origin+location.pathname.replace(/builder\.html$/,'')).replace(/\/$/,'/')+link;
  document.getElementById('preview').style.display='block';
}
</script>
</body>
</html>
